{% extends "base.html" %}

{% block content %}
<div class="form-container">
    <h2>Send Message</h2>

    <div id="key-error" class="error-panel">
        <strong>Attention:</strong> The private key is not loaded.
        <a href="{{ url_for('auth.logout') }}">Log out</a> and log in again.
    </div>

    <form id="sendForm" method="post" enctype="multipart/form-data">
        {{ form.hidden_tag() }}

        <div class="form-group">
            {{ form.recipient.label(class="form-label") }}
            {{ form.recipient(id="recipient", class="form-control", autocomplete="off") }}
        </div>

        <div class="form-group">
            <label for="subject" class="form-label">Subject</label>
            <input type="text" id="subject" class="form-control">
        </div>

        <div class="form-group">
            <label for="content" class="form-label">Content</label>
            <textarea id="content" class="form-control" rows="10"></textarea>
        </div>

        <div class="form-group">
            <label class="form-label">Attachment</label>
            <input type="file" id="file_input" class="form-control" multiple>
            <small class="password-help-text">Max 10 files, max 100MB.</small>
        </div>

        {{ form.subject_encrypted(id='subject_encrypted') }}
        {{ form.content_encrypted(id='content_encrypted') }}
        {{ form.ephemeral_public_key(id="ephemeral_public_key") }}
        {{ form.sender_encrypted_aes_key(id="sender_encrypted_aes_key") }}
        {{ form.recipient_encrypted_aes_key(id="recipient_encrypted_aes_key") }}
        {{ form.signature(id="signature") }}
        
        <div class="hidden">
            {{ form.attachment_blob(id="attachment_blob") }}
        </div>

        {{ form.attachments_metadata_json(id="attachments_metadata_json") }}

        <div class="form-group" style="margin-top: 20px;">
            <button type="submit" id="submitBtn" class="btn">Send Message</button>
        </div>
        
        <div id="status" class="status-message"></div>
    </form>
</div>

<script type="module" src="{{ url_for('static', filename='js/controllers/send.js') }}" nonce="{{ csp_nonce() }}"></script>
{% endblock %}